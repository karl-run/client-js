
SMART on FHIR JavaScript Library
================================

This is a JavaScript library for connecting SMART apps to FHIR servers.
It works both in browsers (IE 10+) and on the server (Node 18+).


> This is the documentation for version 2+. If you want to migrate from older versions, please check out **[what's new in v2](http://docs.smarthealthit.org/client-js/v2.html)** and [migration instructions](migration).


[![NodeJS Tests](https://github.com/smart-on-fhir/client-js/actions/workflows/node.yml/badge.svg?branch=master)](https://github.com/smart-on-fhir/client-js/actions/workflows/node.yml)
[![Browser Tests](https://github.com/smart-on-fhir/client-js/actions/workflows/browser.yml/badge.svg?branch=master)](https://github.com/smart-on-fhir/client-js/actions/workflows/browser.yml)
[![Coverage Status](https://coveralls.io/repos/github/smart-on-fhir/client-js/badge.svg?branch=master)](https://coveralls.io/github/smart-on-fhir/client-js?branch=master)
[![npm version](https://badge.fury.io/js/fhirclient.svg)](https://badge.fury.io/js/fhirclient)
[![types](https://badgen.net/npm/types/fhirclient)](https://badgen.net/npm/types/fhirclient)
[![node](https://badgen.net/npm/node/fhirclient)](https://badgen.net/npm/node/fhirclient)
[![downloads](https://badgen.net/npm/dt/fhirclient)](https://www.npmtrends.com/fhirclient)

## Table of Contents
---
- [Installation](#installation)
- [Browser Usage](#browser-usage)
- [Server Usage](#server-usage)
    - [NodeJS API Details](node.md)
- [SMART API](#smart-api)
    - [Full Documentation](api.md)
- [Client API](#client)
    - [Full Documentation](client.md)
- [API Documentation](typedoc) - Generated by the latest code on `master`
- [Working with multiple windows](targets.md)
- [Connecting to open servers and/or multiple servers](open_servers.md)
- [Contributing and Development](#contributing-and-development)
- [Debugging](#debugging)
- Browser Examples
    - [Basic Examples](https://35u09.codesandbox.io/) - [Code](https://codesandbox.io/s/fhir-client-browser-examples-35u09) - Basic examples with no additional libraries or frameworks
    - [React / TypeScript SPA](https://4e7rl.codesandbox.io/test.html) - [Code](https://codesandbox.io/s/fhir-client-typescript-react-spa-4e7rl) - Example with React and TypeScript on a single page
    - [Advanced React Example](https://0q3n8.codesandbox.io) - [Code](https://codesandbox.io/s/fhir-client-react-react-router-context-0q3n8) - React with React Router, storing a FHIR client instance in React context
    - [Popups and frames](https://fmv99.csb.app/) - [Code](https://codesandbox.io/s/blissful-leavitt-fmv99)
    - [Using multiple launch configurations (code)](https://codesandbox.io/s/fhir-client-browser-examples-35u09?file=/browser/multi_config/launch.html)
- Server Examples
    - [Express Example](https://c0che.sse.codesandbox.io/) - [Code](https://codesandbox.io/s/jovial-dew-c0che)
    - [Native Example](https://q4mhq.sse.codesandbox.io/) - [Code](https://codesandbox.io/s/brave-wildflower-q4mhq)
    - [HAPI Example](https://myq5q.sse.codesandbox.io/) - [Code](https://codesandbox.io/s/fhir-client-hapi-myq5q)
- Other Examples
    - [Request examples](http://docs.smarthealthit.org/client-js/request.html)
    - [Running an app against multiple servers](https://github.com/Unite-Genomics/react-fhir-sample-app)

<br/><br/>


## Installation

### From NPM
```sh
npm i fhirclient
```
### From CDN
Include it with a `script` tag from one of the following locations:

From NPM (latest version):
- https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js
- https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.min.js
- https://cdn.jsdelivr.net/npm/fhirclient@latest/build/fhir-client.js
- https://cdn.jsdelivr.net/npm/fhirclient@latest/build/fhir-client.min.js

From NPM (specific version):
- https://cdn.jsdelivr.net/npm/fhirclient@2.0.7/build/fhir-client.js
- https://cdn.jsdelivr.net/npm/fhirclient@2.0.7/build/fhir-client.min.js

Latest development builds from GitHub:
- https://combinatronics.com/smart-on-fhir/client-js/master/dist/build/fhir-client.js
- https://combinatronics.com/smart-on-fhir/client-js/master/dist/build/fhir-client.min.js


## Browser Usage

In the browser you typically have to create two separate pages that correspond to your
`launch_uri` (Launch Page) and `redirectUri` (Index Page).

### As Library

**Launch Page**
```html
<!-- launch.html -->
<script src="./node_module/fhirclient/build/fhir-client.js"></script>
<script>
FHIR.oauth2.authorize({
    "clientId": "my_web_app",
    "scope"   : "patient/*.read"
});
</script>
```

**Index Page**
```html
<!-- index.html -->
<script src="./node_module/fhirclient/build/fhir-client.js"></script>
<script>
FHIR.oauth2.ready()
    .then(client => client.request("Patient"))
    .then(console.log)
    .catch(console.error);
</script>
```

### As Module
**Launch Page**
```js
import FHIR from "fhirclient"
FHIR.oauth2.authorize({
    "clientId": "my_web_app",
    "scope": "patient/*.read"
});
```

**Index Page**
```js
import FHIR from "fhirclient"
FHIR.oauth2.ready()
    .then(client => client.request("Patient"))
    .then(console.log)
    .catch(console.error);
```

> NOTE: When the library is used as module it will not polyfill the global namespace and will not create a global `FHIR` object as it does when included as script. If you want to be able to use it globally, you can export it yourself like so:

```ts
import FHIR from "fhirclient";

// in JavaScript:
window.FHIR = FHIR;

// In TypeScript:
(window as any).FHIR = FHIR;
```

## Server Usage
The server is fundamentally different environment than the browser but the
API is very similar. Here is a simple Express example:
```js
const fhirClient = require("fhirclient");

// This is what the EHR will call
app.get("/launch", (req, res) => {
    fhirClient(req, res).authorize({
        "clientId": "my_web_app",
        "scope"   : "patient/*.read"
    });
});

// This is what the Auth server will redirect to
app.get("/", (req, res) => {
    fhirClient(req, res).ready()
        .then(client => client.request("Patient"))
        .then(res.json)
        .catch(res.json);
});
```
Read more at the [NodeJS API Details](node).

## SMART API
The SMART API is a collection of SMART-specific methods (`authorize`, `ready`, `init`) for app
authorization and launch. If you are working in a browser, the SMART API is automatically created,
and available at `window.FHIR.oauth2`. In NodeJS, the library exports a function that should be
called with a http request and response objects, and will return the same SMART API as in the browser. 

```js
// BROWSER
const smart = FHIR.oauth2;
smart.authorize(options);

// SERVER
const smart = require("fhirclient");
smart(request, response).authorize(options);
```
Read the [SMART API Documentation](api)


   

## Client
This is a FHIR client that is returned to you from the `ready()` or the `init()`
SMART API calls. You can also create it yourself if needed. For example, there
is no need to authorize against an open FHIR server. You can skip that and start
by creating a client instance:
```js
// BROWSER
const client = FHIR.client({
    serverUrl: "https://r4.smarthealthit.org"
});

// SERVER
const client = fhirClient(req, res).client({
    serverUrl: "https://r4.smarthealthit.org"
});
```

The client instance exposes a super-powered `request` method that you use to query
the FHIR server and a bunch of other useful utilities and methods.
[Read the full Client API docs](client).

## Debugging
This library uses the [debug](https://www.npmjs.com/package/debug) module.

To enable debug logging in Node use the `DEBUG` env variable:
```sh
DEBUG='FHIR.*' node my-app
```
In the browser execute this in the console and then reload the page:
```js
localStorage.debug = "FHIR.*"
```


